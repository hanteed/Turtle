#include <stdlib.h>
#include <stdio.h>
#include "../include.h"

int find_malwares(int ac, char *av[])
{
    char API_KEY[256];
    char id[64];
    int positivesint = 0;
    int indicedanger = 0;

    if(av[1] == NULL)
    {
        printf("Error: Path or file may be invalid");
        return EXIT_FAILURE;
    }
    get_api_key(API_KEY); // Getting the API key in the file
    printf("\n\n\n Active API : '%s'\n",API_KEY);
    get_file_id(id,API_KEY,av); // Getting file ID
    printf("\n File path : '%s'",av[1]);
    printf("\n File ID : '%s'",id);
    check_response_code(id,30); // Checking response code
    positivesint = get_report(id); // Fetching value returned by the analysis of the file so we can display the following messages
    if(positivesint == 0)
        printf(" %d Detections : The file does not seem to be harmful.",positivesint);
    else if(positivesint <= 10 && positivesint > 0) {
        indicedanger = 1;
        printf(" %d Detections : The file is suspicious (index %d/3).",positivesint,indicedanger);
    }
    else if(positivesint > 10 && positivesint <= 25) {
        indicedanger = 2;
        printf(" %d Detections : The file is malicious (index %d/3).",positivesint,indicedanger);
    }
    else if(positivesint > 25) {
        indicedanger = 3;
        printf(" %d Detections : The file is dangerous (index %d/3).",positivesint,indicedanger);
    }
    printf("\n\n\n");
    system("rm id.txt"); // Deleting id.txt
    system("rm response_code.txt"); // Deleting response_code.txt
    system("rm positives.txt"); // Deleting positives.txt
    return EXIT_SUCCESS;
}
